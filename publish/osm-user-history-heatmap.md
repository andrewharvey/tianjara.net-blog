Title: OSM user history heatmap
Date: 2011-01-16 20:06:23
Tags: geo,osm

In the past few months I've been contributing to the <a href="http://www.openstreetmap.org/">OpenStreetMap</a> database. From the day I started I've had privacy concerns on my mind. If a criminal goes around committing crimes, leaving behind a signature and always travelling x km from home to commit the crime, you get a nice circle around their home. So I'm interested to see what kind of pattern I'm leaving behind. Someone else has probably got an existing solution out there, but I decided to experiment and put together something myself.

I already had all my osmChange files (i.e. the ones from http://www.openstreetmap.org/api/0.6/changeset/${changeset_id}/download). I pull these daily from http://api.openstreetmap.org/api/0.6/changesets?display_name=aharvey find the changeset ids and download the osmChange files for all my new changesets. I do this as I try to keep a local copy of things I upload into the cloud, as a backup in case the service I uploaded to ever decides to cut my access. I know I should really be saving a copy of what I upload, rather than uploading then asking the cloud server for a copy, but JOSM uploads a full osm file, not an osmChange file. <a href="https://github.com/andrewharvey/OpenStreetMap-User-Edits-Heatmap/tree/master/osmChange_files">Scripts here</a>.

Anyway, from these osmChange files I pull out the coordinates of all the nodes I created or modified, <a href="https://github.com/andrewharvey/OpenStreetMap-User-Edits-Heatmap/blob/master/extract-nodes.pl">script here</a>.

From this list of points I could use any heat map program. <a href="http://code.google.com/p/gheat/">gheat</a> which is based on <a href="http://blog.corunet.com/the-definitive-heatmap/">http://blog.corunet.com/the-definitive-heatmap/</a> looks good. The problem is I ran out of time setting it up– it wasn't in the Debian repository. Instead I used <a href="http://www.sethoscope.net/heatmap/">http://www.sethoscope.net/heatmap/</a>, which I combined with a <a href="https://github.com/andrewharvey/OpenStreetMap-User-Edits-Heatmap/blob/master/render-heatmap-to-tiles.pl">wrapper script</a> to render to tiles in the <a href="http://wiki.openstreetmap.org/wiki/Slippy_map_tilenames">OSM Slippy Map format</a>. However it is really slow– perhaps I should try to speed it up.

Now that I had the transparent heat map tiles, the next step was to get these on top of an OpenStreetMap map. Given they are in the standard format, it should be really easy to add this layer to any software that lets you view OSM tiles. Support for overlays like this in libchamplain is on my todo list, in the meantime I gave <a href="http://polymaps.org">Polymaps</a> a try, <a href="https://github.com/andrewharvey/OpenStreetMap-User-Edits-Heatmap/blob/master/polymaps-overlay.html">HTML with JavaScript embedded here</a>.

[caption id="attachment_1246" align="aligncenter" width="600" caption="Heat map image of my created or modified nodes in OpenStreetMap"]<a href="/blog/attachments/2011/01/osmchange-heatmap.png"><img class="size-full wp-image-1246" title="osmchange-heatmap" src="/blog/attachments/2011/01/osmchange-heatmap.png" alt="Heat map image of my created or modified nodes in OpenStreetMap" width="600" height="600" /></a>[/caption]

The results don't come as much of a surprise, I already knew which areas I edit and how much. This map is also biased towards nodes, and doesn't take into account editing an existing way or relation. One surprise was some cosmetic work along creeks shows up as  nice lines (tracing a creek adds a lot more nodes than adding a single toilet node)...
<h2>Postscript</h2>
While I was working on this I once again needed a bbox string to test with. This has come up a lot in the past and I didn't know any easily way to use a GUI to position the map, and then just copy and paste the bounding box of that view. So <a href="http://gitorious.org/libchamplain/andrewharveys-experiments-mainline/commit/1b3babbc0804ca3fab1566e8198620416a950455">I made a modification to one of the libchamplain demos</a> to return a bounding box from the current view.